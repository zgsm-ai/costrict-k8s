# values.yaml

# 应用配置
appName: "quota-manager"
serviceName: "quota-manager-svc"
containerName: "quota-manager"
containerPort: 8080

# 副本数
replicaCount: 1

# 镜像配置
image:
  repository: "zgsm/quota-manager"
  pullPolicy: IfNotPresent
  tag: "1.0.21"

# 命令配置
command:
  - /app/quota-manager
  - -c
  - /app/conf/conf.yaml

# 资源限制
resources:
  requests:
    cpu: "4"
    memory: 8Gi
  limits:
    cpu: "8"
    memory: 16Gi

# 环境变量
env:
  TZ: "Asia/Shanghai"
  INDEX_NODE: "0"
  DB_PASSWORD: ""

# 配置文件参数
config:
  conf.yaml: |
    database:
      host: "postgresql"
      port: 5432
      user: "costrict"
      password: "costrict"
      dbname: "quota_manager"
      sslmode: "disable"

    auth_database:
      host: "postgresql"
      port: 5432
      user: "costrict"
      password: "costrict"
      dbname: "auth"
      sslmode: "disable"

    aigateway:
      host: "higress-gateway"
      port: 80
      admin_path: "/v1/chat/completions/quota"
      auth_header: "x-admin-key"
      auth_value: "12345678"

    server:
      port: 8080
      mode: "release"
      token_header: "authorization"

    scheduler:
      scan_interval: "0 * * * * *" # Scan every hour

    voucher:
      signing_key: ""

    github_star_check:
      enabled: false
      required_repo: "zgsm-ai.costrict"

    log:
      level: "warn"
      stdout_only: true

# 存储配置
storage:
  logs:
    sizeLimit: 5Gi

# Service 配置
service:
  type: ClusterIP
  port: 8080
  targetPort: 8080

# 健康检查配置
livenessProbe:
  initialDelaySeconds: 15
  periodSeconds: 20

# HPA 配置
hpa:
  enabled: true # 是否启用 HPA
  minReplicas: 1 # 最小副本数
  maxReplicas: 5 # 最大副本数
  targetCPUUtilizationPercentage: 80 # CPU 使用率目标百分比
  targetMemoryUtilizationPercentage: 80 # 内存使用率目标百分比
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 30 # 扩容稳定窗口时间
      policies:
      - type: Percent
        value: 50 # 每次最多增加 50% 的副本数
        periodSeconds: 60
      - type: Pods
        value: 2 # 每次最多增加 2 个副本
        periodSeconds: 60
      selectPolicy: Max # 选择较大的策略
    scaleDown:
      stabilizationWindowSeconds: 300 # 缩容稳定窗口时间（5分钟）
      policies:
      - type: Percent
        value: 10 # 每次最多减少 10% 的副本数
        periodSeconds: 60
      - type: Pods
        value: 1 # 每次最多减少 1 个副本
        periodSeconds: 60
      selectPolicy: Min # 选择较小的策略